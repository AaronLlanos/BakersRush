"use strict";angular.module("app",["phaser","CodeMirror","ui.router","app.menu","app.game","app.game.controls"]).config(["$urlRouterProvider",function(a){a.otherwise("/menu")}]),angular.module("phaser",[]).factory("Phaser",["$window",function(a){a._thirdParty=a._thirdParty||{},a._thirdParty.Phaser=a.Phaser;try{delete a.Phaser}catch(b){a.Phaser=void 0}return a._thirdParty.Phaser}]),angular.module("CodeMirror",[]).factory("CodeMirror",["$window",function(a){a._thirdParty=a._thirdParty||{},a._thirdParty.CodeMirror=a.CodeMirror;try{delete a.CodeMirror}catch(b){a.CodeMirror=void 0}return a._thirdParty.CodeMirror}]),angular.module("app.game",[]).config(["$stateProvider",function(a){a.state("game",{url:"/game","abstract":!0,template:"<div game-canvas></div>"}).state("game.play",{url:"/:id",controller:"GameCtrl"})}]),angular.module("app.game").controller("GameCtrl",["$scope",function(a){a.highestLevel=0,a.currentLevel=0}]),angular.module("app.game").directive("gameCanvas",["GameFactory","GameControlFactory","$log","$timeout",function(a,b,c,d){var e=function(b,c,d){b.fval=[],b.game=a.createGame(c,b,b.mapId),b.$on("$destroy",function(){a.destroyGame(b.game)}),b.endLevel=function(){console.log("end level!")},b.nextDirection=function(){console.log("next platform!")},b.runCommand=function(a){b.fval=a.reverse(),b.game.state.restart()}},f=function(a,b){};return f.$inject=["$scope","$element"],{restrict:"A",scope:{players:"=",mapId:"="},templateUrl:"scripts/game/game.html",link:e,controller:f}}]),angular.module("app.game").factory("GameFactory",["Phaser","GameStates",function(a,b){function c(c,d,e){var f=parseInt(c.find("#gameCanvas").css("width"),10),g=f/2,h=new a.Game(f,g,a.AUTO,"gameCanvas");return h.state.add("Introduction",b.Introduction(h,d)),h.state.add("Level1",b.Level1(h)),h.state.start("Introduction"),h}function d(a){a.destroy()}return{createGame:c,destroyGame:d}}]),angular.module("app.game").factory("GameStates",["Phaser","IntroductionFactory",function(a,b){function c(a,c){return b.getIntro(a,c)}function d(a){}return{Introduction:c,Level1:d}}]),angular.module("app.game").factory("IntroductionFactory",["Phaser",function(a){function b(b,n){return{findObjectsByType:function(a,b,c){var d=[];return b.objects[c].forEach(function(c){c.type===a&&(c.y-=b.tileHeight/(4/3),d.push(c))}),d},createFromTiledObject:function(a,b){var c=b.create(a.x,a.y,a.properties.display);Object.keys(a.properties).forEach(function(b){c[b]=a.properties[b]})},preload:function(){b.load.tilemap("introMap","assets/maps/intro_map.json",null,a.Tilemap.TILED_JSON),b.load.spritesheet("mouse","assets/sprites/mouse.png",100,50),b.load.image("platform","assets/sprites/platformsprite.png",25,25),b.load.image("cheese","assets/sprites/cheese.png",75,75),b.load.image("cookie","assets/cookie-crumb.png"),b.load.spritesheet("map_tiles","assets/maps/tilemap.png",100,100),b.load.image("background_image","assets/woodgrain-background.jpg"),i=!1},create:function(){var g=this;this.map=b.add.tilemap("introMap"),this.background=b.add.tileSprite(0,0,this.world.width,this.world.height,"background_image"),this.background.fixedToCamera=!0,this.map.addTilesetImage("cheese","cheese"),this.map.addTilesetImage("objectLayer","cookie"),this.map.addTilesetImage("platform","platform"),this.map.addTilesetImage("tileMap","map_tiles");var h=this.findObjectsByType("cheese",this.map,"Object Layer 1");e=b.add.group(),e.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,e)}),h=this.findObjectsByType("collectable",this.map,"Object Layer 1"),d=b.add.group(),d.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,d)}),h=this.findObjectsByType("platform",this.map,"Object Layer 1"),f=b.add.group(),f.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,f)}),h=this.findObjectsByType("playerStart",this.map,"Object Layer 1"),c=b.add.sprite(h[0].x,h[0].y,"mouse"),b.physics.enable(c,a.Physics.ARCADE),c.animations.add("idle_right",[0],5,!0),c.animations.add("right",[1,2],5,!0),c.animations.add("idle_left",[3],5,!0),c.animations.add("left",[4,5],5,!0),c.facing="right",b.camera.follow(c),this.createScore()},update:function(){b.physics.arcade.collide(c,this.tileLayer),b.physics.arcade.overlap(c,d,this.collect,null,this),b.physics.arcade.overlap(c,f,this.onPlatform,null,this),b.physics.arcade.overlap(c,e,this.endLevel,null,this)},collect:function(a,b){b.destroy(),m+=10,j.text="Score: "+m},endLevel:function(a,b){g!==b&&(h=g,g=b,this.changeDir("idle"),a.body.x=b.body.x,a.body.y=b.body.y,n.endLevel())},onPlatform:function(a,b){var c;g!==b&&(h=g,g=b,this.changeDir("idle"),console.log(a),console.log(b),a.body.center.x=b.body.center.x,a.body.center.y=b.body.center.y,n.fval.length>0&&(c=n.fval.pop(),this.changeDir(c.func),n.nextDirection()))},createScore:function(){k="20px Arial",l={x:b.world.bounds.topLeft.x,y:b.world.bounds.topLeft.y},j=b.add.text(l.x+60,l.y,"Score: 0",{font:k,stroke:"#ff51d8",strokeThickness:15}),j.fixedToCamera=!0},changeDir:function(a){var b=c.body.velocity;"left"===a?(b.x=-200,"left"!==c.facing&&(c.facing="left"),c.animations.play("left")):"up"===a?(b.y=-200,"left"===c.facing?c.animations.play("left"):c.animations.play("right")):"right"===a?(b.x=200,"right"!==c.facing&&(c.facing="right"),c.animations.play("right")):"down"===a?(b.y=200,"left"===c.facing?c.animations.play("left"):c.animations.play("right")):(b.x=0,b.y=0,"idle"!==c.facing&&("left"===c.facing?c.animations.play("idle_left"):c.animations.play("idle_right")))}}}var c,d,e,f,g,h,i,j,k,l,m=0;return{getIntro:b,getMouse:c}}]),angular.module("app.game.controls",[]).directive("gameCommand",["GameControlFactory","CodeMirror",function(a,b){return{templateUrl:"scripts/game/controls/control_box.html",link:function(c,d,e){c.editor=b.fromTextArea(document.getElementById("add-command"),{lineNumbers:!0,theme:"dracula"});var f=b.hint.html;b.hint.html=function(a){var b=f(a)||{from:a.getCursor(),to:a.getCursor(),list:[]};return b.list.push("right()"),b.list.push("up()"),b.list.push("down()"),b.list.push("left()"),b},c.editor.on("keyup",function(a,c){var d={9:"tab",13:"enter",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",38:"up",40:"down"};d[(c.keyCode||c.which).toString()]||b.showHint(a,b.hint.html)}),c.run=function(){var b,e,f;b=d.find(".CodeMirror-line"),e=[],angular.forEach(b,function(a){e.push(a.innerText)}),b=e,e=a.formatCommands(b),f=a.checkSyntax(e),c.runCommand(e)},c.showError=function(a){console.log("showing an error here")}},controller:["$scope","$element",function(a,b){}]}}]),angular.module("app.game.controls").factory("GameControlFactory",[function(){function a(a){function b(a){return"right"===a||"left"===a||"up"===a||"down"===a?!0:!1}return angular.forEach(a,function(a){a.correctSyntax=b(a.func)}),a}function b(a){var b,c,d,e=[];return angular.forEach(a,function(a){a.indexOf("(")>=0&&a.indexOf(")")>=0&&(a=a.trim(),d=a.split("("),b=d[0].trim(),c=d[1].split(")")[0].trim(),e.push({val:a,func:b,args:c}))}),e}return{formatCommands:b,checkSyntax:a}}]),angular.module("app.menu",[]).config(["$stateProvider",function(a){a.state("menu",{url:"/menu",templateUrl:"scripts/menu/menu.html",controller:"MenuCtrl as ctrl"})}]),angular.module("app.menu").controller("MenuCtrl",[function(){var a=this,b=angular.element("audio")[0];a.levels=[],a.playSound=function(){b.play()},a.createId=function(){return(new Date).getTime().toString()}}]);