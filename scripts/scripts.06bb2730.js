"use strict";angular.module("app",["phaser","CodeMirror","ui.router","app.menu","app.game","app.game.controls"]).config(["$urlRouterProvider",function(a){a.otherwise("/menu")}]),angular.module("phaser",[]).factory("Phaser",["$window",function(a){a._thirdParty=a._thirdParty||{},a._thirdParty.Phaser=a.Phaser;try{delete a.Phaser}catch(b){a.Phaser=void 0}return a._thirdParty.Phaser}]),angular.module("CodeMirror",[]).factory("CodeMirror",["$window",function(a){a._thirdParty=a._thirdParty||{},a._thirdParty.CodeMirror=a.CodeMirror;try{delete a.CodeMirror}catch(b){a.CodeMirror=void 0}return a._thirdParty.CodeMirror}]),angular.module("app.game",[]).config(["$stateProvider",function(a){a.state("game",{url:"/game","abstract":!0,template:"<div game-canvas></div>"}).state("game.play",{url:"/:id",controller:"GameCtrl"})}]),angular.module("app.game").controller("GameCtrl",["$scope",function(a){}]),angular.module("app.game").directive("gameCanvas",["GameFactory","GameControlFactory",function(a,b){var c=function(a,b,c){},d=function(b,c){var d,e,f;b.fval=e=[],b.runIndex=d=0,b.game=f={},b.highestLevel=0,b.currentLevel=0,b.soundOn=!0,b.runCommand=function(a){b.fval=a.reverse(),f.state.restart()},b.endLevel=function(){b.$broadcast("completeDirection",!1),b.currentLevel+=1,b.currentLevel>b.highestLevel&&(b.highestLevel=b.currentLevel),b.$broadcast("triggerTransition")},b.nextDirection=function(){b.$broadcast("changeDirection",d),b.runIndex+=1},b.completeDirection=function(a){b.$broadcast("completeDirection",a)},f=a.createGame(c,b,b.mapId),b.$on("$destroy",function(){a.destroyGame(f)})};return d.$inject=["$scope","$element"],{restrict:"A",scope:{players:"=",mapId:"="},templateUrl:"templates/game/game.html",link:c,controller:d}}]),angular.module("app.game").factory("GameFactory",["Phaser","GameStates",function(a,b){function c(c,d,e){var f=parseInt(c.find("#gameCanvas").css("width"),10),g=375,h=new a.Game(f,g,a.AUTO,"gameCanvas");return h.state.add("Introduction",b.Introduction(h,d)),h.state.add("Level1",b.Level1(h,d)),h.state.start("Introduction"),h}function d(a){a.destroy()}return{createGame:c,destroyGame:d}}]),angular.module("app.game").factory("GameStates",["Phaser","IntroductionFactory",function(a,b){function c(a,c){return b.getIntro(a,c)}function d(a){}return{Introduction:c,Level1:d}}]),angular.module("app.game").directive("transitionModal",[function(){function a(a,b,c){}function b(a,b){a.$on("triggerTransition",function(){b.find(".modal").modal("show")})}return b.$inject=["$scope","$element"],{restrict:"A",link:a,controller:b,templateUrl:"templates/game/level_transition.html"}}]),angular.module("app.game").factory("IntroductionFactory",["Phaser",function(a){function b(b,n){return{findObjectsByType:function(a,b,c){var d=[];return b.objects[c].forEach(function(c){c.type===a&&(c.y-=b.tileHeight/(4/3),d.push(c))}),d},createFromTiledObject:function(a,b){var c=b.create(a.x,a.y,a.properties.display);Object.keys(a.properties).forEach(function(b){c[b]=a.properties[b]})},preload:function(){b.load.tilemap("introMap","assets/maps/intro_map.json",null,a.Tilemap.TILED_JSON),b.load.spritesheet("mouse","assets/sprites/mouse.214dfc50.png",100,50),b.load.image("platform","assets/sprites/platformsprite.f54ce4a4.png",100,50),b.load.image("cheese","assets/sprites/cheese.1c0cf8c1.png",75,75),b.load.image("cookie","assets/cookie-crumb.8f60c0d3.png"),b.load.spritesheet("map_tiles","assets/maps/tilemap.3e0f7d41.png",100,100),b.load.image("background_image","assets/woodgrain-background.469c2fa5.jpg"),i=!1},create:function(){var g=this;this.map=b.add.tilemap("introMap"),this.map.addTilesetImage("cheese","cheese"),this.map.addTilesetImage("objectLayer","cookie"),this.map.addTilesetImage("platform","platform"),this.map.addTilesetImage("tileLayer","map_tiles"),this.tileLayer=this.map.createLayer("Tile Layer 1"),this.tileLayer.resizeWorld();var h=this.findObjectsByType("cheese",this.map,"Object Layer 1");e=b.add.group(),e.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,e)}),h=this.findObjectsByType("collectable",this.map,"Object Layer 1"),d=b.add.group(),d.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,d)}),h=this.findObjectsByType("platform",this.map,"Object Layer 1"),f=b.add.group(),f.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,f)}),h=this.findObjectsByType("playerStart",this.map,"Object Layer 1"),c=b.add.sprite(h[0].x,h[0].y,"mouse"),b.physics.enable(c,a.Physics.ARCADE),c.animations.add("idle_right",[0],5,!0),c.animations.add("right",[1,2],5,!0),c.animations.add("idle_left",[3],5,!0),c.animations.add("left",[4,5],5,!0),c.facing="right",b.camera.follow(c),this.createScore()},update:function(){b.physics.arcade.collide(c,this.tileLayer),b.physics.arcade.overlap(c,d,this.collect,null,this),b.physics.arcade.overlap(c,f,this.onPlatform,null,this),b.physics.arcade.overlap(c,e,this.endLevel,null,this)},collect:function(a,b){b.destroy(),m+=10,j.text="Score: "+m},endLevel:function(a,b){g!==b&&(h=g,g=b,this.changeDir("idle"),a.body.x=b.body.x,a.body.y=b.body.y,n.endLevel())},onPlatform:function(a,b){var c;g!==b&&(h=g,g=b,this.changeDir("idle"),a.body.x=b.body.x,a.body.y=b.body.y-12,n.completeDirection(!1),n.fval.length>0&&(c=n.fval.pop(),this.changeDir(c.func),n.nextDirection()))},createScore:function(){k="20px Arial",l={x:b.world.bounds.topLeft.x,y:b.world.bounds.topLeft.y},j=b.add.text(l.x+60,l.y,"Score: 0",{font:k,stroke:"#ff51d8",strokeThickness:15}),j.fixedToCamera=!0},changeDir:function(a){var b=c.body.velocity;"left"===a?(b.x=-200,"left"!==c.facing&&(c.facing="left"),c.animations.play("left")):"up"===a?(b.y=-200,"left"===c.facing?c.animations.play("left"):c.animations.play("right")):"right"===a?(b.x=200,"right"!==c.facing&&(c.facing="right"),c.animations.play("right")):"down"===a?(b.y=200,"left"===c.facing?c.animations.play("left"):c.animations.play("right")):(b.x=0,b.y=0,"idle"!==c.facing&&("left"===c.facing?c.animations.play("idle_left"):c.animations.play("idle_right")))}}}var c,d,e,f,g,h,i,j,k,l,m=0;return{getIntro:b}}]),angular.module("app.game").factory("LevelFactory",["Phaser",function(a){function b(b,n){return{findObjectsByType:function(a,b,c){var d=[];return b.objects[c].forEach(function(c){c.type===a&&(c.y-=b.tileHeight/(4/3),d.push(c))}),d},createFromTiledObject:function(a,b){var c=b.create(a.x,a.y,a.properties.display);Object.keys(a.properties).forEach(function(b){c[b]=a.properties[b]})},preload:function(){b.load.tilemap("introMap","assets/maps/intro_map.json",null,a.Tilemap.TILED_JSON),b.load.spritesheet("mouse","assets/sprites/mouse.214dfc50.png",100,50),b.load.image("platform","assets/sprites/platformsprite.f54ce4a4.png",25,25),b.load.image("cheese","assets/sprites/cheese.1c0cf8c1.png",75,75),b.load.image("cookie","assets/cookie-crumb.8f60c0d3.png"),b.load.spritesheet("map_tiles","assets/maps/tilemap.3e0f7d41.png",100,100),b.load.image("background_image","assets/woodgrain-background.469c2fa5.jpg"),i=!1},create:function(){var g=this;this.map=b.add.tilemap("introMap"),this.background=b.add.tileSprite(0,0,this.world.width,this.world.height,"background_image"),this.background.fixedToCamera=!0,this.map.addTilesetImage("cheese","cheese"),this.map.addTilesetImage("objectLayer","cookie"),this.map.addTilesetImage("platform","platform"),this.map.addTilesetImage("tileMap","map_tiles");var h=this.findObjectsByType("cheese",this.map,"Object Layer 1");e=b.add.group(),e.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,e)}),h=this.findObjectsByType("collectable",this.map,"Object Layer 1"),d=b.add.group(),d.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,d)}),h=this.findObjectsByType("platform",this.map,"Object Layer 1"),f=b.add.group(),f.enableBody=!0,angular.forEach(h,function(a){g.createFromTiledObject(a,f)}),h=this.findObjectsByType("playerStart",this.map,"Object Layer 1"),c=b.add.sprite(h[0].x,h[0].y,"mouse"),b.physics.enable(c,a.Physics.ARCADE),c.animations.add("idle_right",[0],5,!0),c.animations.add("right",[1,2],5,!0),c.animations.add("idle_left",[3],5,!0),c.animations.add("left",[4,5],5,!0),c.facing="left",b.camera.follow(c),this.createScore()},update:function(){b.physics.arcade.collide(c,this.tileLayer),b.physics.arcade.overlap(c,d,this.collect,null,this),b.physics.arcade.overlap(c,f,this.onPlatform,null,this),b.physics.arcade.overlap(c,e,this.endLevel,null,this)},collect:function(a,b){b.destroy(),m+=10,j.text="Score: "+m},endLevel:function(a,b){g!==b&&(h=g,g=b,this.changeDir("idle"),a.body.x=b.body.x,a.body.y=b.body.y,n.endLevel())},onPlatform:function(a,b){var c;g!==b&&(h=g,g=b,this.changeDir("idle"),a.body.x=b.body.x-50,a.body.y=b.body.y,n.completeDirection(!1),n.fval.length>0&&(c=n.fval.pop(),this.changeDir(c.func),n.nextDirection()))},createScore:function(){k="20px Arial",l={x:b.world.bounds.topLeft.x,y:b.world.bounds.topLeft.y},j=b.add.text(l.x+60,l.y,"Score: 0",{font:k,stroke:"#ff51d8",strokeThickness:15}),j.fixedToCamera=!0},changeDir:function(a){var b=c.body.velocity;"left"===a?(b.x=-200,"left"!==c.facing&&(c.facing="left"),c.animations.play("left")):"up"===a?(b.y=-200,"left"===c.facing?c.animations.play("left"):c.animations.play("right")):"right"===a?(b.x=200,"right"!==c.facing&&(c.facing="right"),c.animations.play("right")):"down"===a?(b.y=200,"left"===c.facing?c.animations.play("left"):c.animations.play("right")):(b.x=0,b.y=0,"idle"!==c.facing&&("left"===c.facing?c.animations.play("idle_left"):c.animations.play("idle_right")))}}}var c,d,e,f,g,h,i,j,k,l,m=0;return{getLevel1:b}}]),angular.module("app.game.controls",[]).directive("gameCommand",["GameControlFactory","CodeMirror",function(a,b){return{templateUrl:"templates/game/control_box.html",link:function(a,c,d){a.editor=b.fromTextArea(document.getElementById("add-command"),{lineNumbers:!0,theme:"dracula"});var e=b.hint.html;b.hint.html=function(a){var b=e(a)||{from:a.getCursor(),to:a.getCursor(),list:[]};return b.list.push("right()"),b.list.push("up()"),b.list.push("down()"),b.list.push("left()"),b},a.editor.on("keyup",function(a,c){var d={9:"tab",13:"enter",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",38:"up",40:"down"};d[(c.keyCode||c.which).toString()]||b.showHint(a,b.hint.html)})},controller:["$scope","$element",function(b,c){var d;b.userCodeLines=d=[],b.run=function(){var e,f,g=[];d=c.find(".CodeMirror-line"),b.runIndex=0,angular.forEach(d,function(a){c.find(a).css("background-color","rgba(0,0,0,0)"),g.push(a.innerText)}),e=g,g=a.formatCommands(e),f=a.checkSyntax(g),b.runCommand(g)},b.changeDirection=function(){var a="rgba(118,218,255,0.3)",e=d[b.runIndex];c.find(e).css("background-color",a)},b.completeDirection=function(a,e){if(0!==b.runIndex){var f="rgba(74,255,71,0.3)",g="rgba(255,81,216,0.5)",h=d[b.runIndex-1];e?c.find(h).css("background-color",g):c.find(h).css("background-color",f)}},b.$on("changeDirection",b.changeDirection),b.$on("completeDirection",b.completeDirection)}]}}]),angular.module("app.game.controls").factory("GameControlFactory",[function(){function a(a){function b(a){return"right"===a||"left"===a||"up"===a||"down"===a?!0:!1}return angular.forEach(a,function(a){a.correctSyntax=b(a.func)}),a}function b(a){var b,c,d,e=[];return angular.forEach(a,function(a){a.indexOf("(")>=0&&a.indexOf(")")>=0&&(a=a.trim(),d=a.split("("),b=d[0].trim(),c=d[1].split(")")[0].trim(),e.push({val:a,func:b,args:c}))}),e}return{formatCommands:b,checkSyntax:a}}]),angular.module("app.menu",[]).config(["$stateProvider",function(a){a.state("menu",{url:"/menu",templateUrl:"templates/menu/menu.html",controller:"MenuCtrl as ctrl"})}]),angular.module("app.menu").controller("MenuCtrl",[function(){var a=this,b=angular.element("audio")[0];a.levels=[],a.playSound=function(){b.play()},a.createId=function(){return(new Date).getTime().toString()}}]),angular.module("app").run(["$templateCache",function(a){a.put("templates/game/control_box.html",'<div id="game-options"> <div id="inputbox"> <div class="form-group"> <label for="add-command"> Command box: </label> <!-- <textarea id="add-command" class="form-control code"></textarea> --> <textarea id="add-command" class="form-control" data-provide="typeahead"></textarea> <button class="btn btn-success form-control" ng-click="run()">Run</button> </div> </div> </div>'),a.put("templates/game/game.html",'<div class="bg-primary"> <div id="control-box" class="container"> <button type="text" class="btn btn-game"><i class="fa fa-volume-up"></i></button> <button type="text" class="btn btn-game"><i class="fa fa-trophy"></i></button> </div> </div> <div class="col-xs-12 col-sm-8"> <div id="gameCanvas"></div> </div> <div game-command class="col-xs-12 col-sm-4 bg-primary" style="font: initial"></div> <div class="col-sm-8"> <h2>About Bakers Rush</h2> <hr> <p>You are currently a mouse living in a bakery that has an old grumpy baker close shop every night. He is so old and grumpy that he leaves the shop without cleaning up so he can watch his TV and go to sleep. It is your job to clean up all of the cookie crumbs after him and to get to the big cheese every night that he leaves out!</p> </div> <div class="col-xs-12 col-sm-4"> </div> <div transition-modal></div>'),a.put("templates/game/level_transition.html",'<!-- Modal --> <div class="modal fade" id="transition-modal" tabindex="-1" role="dialog" aria-labelledby="transition-modalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" id="transition-modalLabel">Hooray!</h4> </div> <div class="modal-body"> ... </div> <div class="modal-footer"> <button type="button" class="btn btn-primary" ng-click="scope.nextLevel()">Next Level!</button> </div> </div> </div> </div>'),a.put("templates/menu/menu.html",'<div class="main-menu"> <div class="row"> <div class="col-xs-12 col-sm-6"> <div class="create text-center" ui-sref="game.play({id: ctrl.createId()})"> <a class="menu-button" ng-mouseover="ctrl.playSound()"><h2>New Game</h2></a> </div> </div> <div class="col-xs-12 col-sm-6"> <h2 class="center-text">Saved Games</h2> <div class="play" ng-repeat="level in ctrl.levels track by level.id" ui-sref="game.play({id: level.id})"> Name: <span ng-bind="level.name"></span> </div> </div> </div> <audio> <source src="assets/beep.mp3" type="audio/mpeg"> </source></audio> </div>')}]);